<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempo MentorOps | Supabase</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
        }

        :root {
            --tempo-blue: #2563EB;
            --tempo-dark: #111827;
        }

        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-in-right { animation: slideInRight 0.3s ease-out forwards; }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Supabase Config ---
        const SUPABASE_URL = "https://mifbpckstfwphkwtqksa.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZmJwY2tzdGZ3cGhrd3Rxa3NhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MzcyMDksImV4cCI6MjA4NjUxMzIwOX0.PDZwE9hII9kPOjrBeJAI8T28oetruK-ogFtKOICMlOQ";
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- Icons ---
        const Icon = ({ path, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );

        const LayoutDashboard = (props) => <Icon {...props} path={<><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></>} />;
        const AlertCircle = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></>} />;
        const CreditCard = (props) => <Icon {...props} path={<><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></>} />;
        const Footprints = (props) => <Icon {...props} path={<><path d="M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 11 3.8 11 8c0 2.25-.79 4.33-2 6"/><path d="M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 13 7.8 13 12c0 2.25.79 4.33 2 6"/><path d="M16 17h4"/><path d="M4 13h4"/></>} />;
        const Gift = (props) => <Icon {...props} path={<><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></>} />;
        const Megaphone = (props) => <Icon {...props} path={<><path d="m3 11 18-5v12L3 14v-3z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/></>} />;
        const Plus = (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />;
        const Search = (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></>} />;
        const CheckCircle2 = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>} />;
        const Clock = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />;
        const Filter = (props) => <Icon {...props} path={<><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></>} />;
        const FileText = (props) => <Icon {...props} path={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></>} />;
        const User = (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />;
        const LogOut = (props) => <Icon {...props} path={<><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></>} />;
        const ClipboardList = (props) => <Icon {...props} path={<><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></>} />;
        const MessageCircle = (props) => <Icon {...props} path={<><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></>} />;
        const Download = (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />;
        const Edit = (props) => <Icon {...props} path={<><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"/></>} />;

        // --- Static Data ---
        const mentorList = [ "Noha Radwan", "Rashad Mohamed", "Emad Mohamed", "Mohamed Mounir" ];
        const associateList = [ "Ariath Piol", "Job James", "Lina Hesham", "Mohab Magdy", "Marwa Ahmed", "Ramadan Philip", "Aida Clement", "Hassan Khallaf", "Nada Ashraf", "Ruben Joseph", "Esraa Tarek Eroq", "Ahmed Abdelghany", "Nour Ayman", "Ashraf Essam", "Hala Ayman", "Rania Mohamed", "Salma Ahmed", "Marwan Hassan", "Osama M. Adam", "Marwan Zakaria", "Shahd Emad", "Ahmed Nasser abdelhakim" ];
        const quizModules = [
            { id: 'productExpert', title: 'Product Expert', desc: 'Is the associate able to demonstrate product expertise when queried by the customer?' },
            { id: 'processAwareness', title: 'Process Awareness', desc: 'Comprehending the process, rather than just adhering to its procedures.' },
            { id: 'communication', title: 'Communication', desc: 'Did the associate reflect effectiveness in communicating with the customer?' },
            { id: 'customerConcern', title: 'Able to identify customer Concern', desc: 'Did the associate comprehend all of the customer\'s concerns effectively?' },
            { id: 'fcr', title: 'FCR', desc: 'Was the associate able to anticipate all the customer questions?' }
        ];

        const categories = {
            disputes: { label: 'Disputes', icon: AlertCircle, color: 'red', fields: ['customerName', 'customerEmail', 'disputeAmount', 'disputeDate', 'disputeReason', 'disputedProduct', 'disputeLink', 'resolution'] },
            pending_subs: { label: 'Pending Subs', icon: CreditCard, color: 'blue', fields: ['customerName', 'customerEmail', 'pendingReason', 'resolution'] },
            floorwalker: { label: 'FloorWalker', icon: Footprints, color: 'amber', fields: ['associateName', 'ticketLink', 'reasonForSupport', 'requestType', 'validRequest', 'slackLink', 'comment'] },
            hip_request: { label: 'HIP Request', icon: MessageCircle, color: 'teal', fields: ['associateName', 'ticketLink', 'slackLink', 'validHip', 'invalidReason', 'hipRequestType'] },
            weekly_quiz: { label: 'Weekly Quiz', icon: ClipboardList, color: 'cyan', fields: ['associateName', 'associateEmail', 'date', 'correctionModule'] },
            duplicate_iap: { label: 'Duplicate IAP', icon: FileText, color: 'indigo', fields: ['customerEmail', 'emailSent', 'subscriptionStatus'] },
            surprise_delight: { label: 'Surprise & Delight', icon: Gift, color: 'purple', fields: ['agent', 'team', 'customerName', 'customerEmail', 'productType', 'ticketUrl', 'surpriseAndDelightReason', 'surpriseAndDelightType', 'amount', 'date', 'notes'] },
            mx_announcement: { label: 'MX Announcement', icon: Megaphone, color: 'emerald', fields: ['title', 'channel', 'readReceipts'] },
        };

        // --- Components ---
        const Card = ({ children, className = "" }) => <div className={`bg-white rounded-xl border border-slate-200 shadow-sm ${className}`}>{children}</div>;
        const Badge = ({ children, color = "slate" }) => {
            const colors = { slate: "bg-slate-100 text-slate-700", red: "bg-rose-100 text-rose-700", blue: "bg-blue-100 text-blue-700", green: "bg-emerald-100 text-emerald-700", amber: "bg-amber-100 text-amber-700", teal: "bg-teal-100 text-teal-700", cyan: "bg-cyan-100 text-cyan-700" };
            return <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${colors[color] || colors.slate}`}>{children}</span>;
        };

        function MentorOpsCenter() {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [tasks, setTasks] = useState([]);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            
            const [isFormOpen, setIsFormOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [editingTaskId, setEditingTaskId] = useState(null);
            const [newTaskType, setNewTaskType] = useState('disputes');
            const [formData, setFormData] = useState({});
            
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 10;
            const [reportFilters, setReportFilters] = useState({ category: 'all', agent: 'all', startDate: '', endDate: '' });
            const [generatedReport, setGeneratedReport] = useState(null);

            const [pendingReasonsList] = useState(["Not delivered", "Delivered but not updated.", "Returned or canceled order"]);
            const [disputeReasonsList] = useState(["Subscription claim", "Unauthorized purchase", "Defective product", "Credit not processed"]);
            const [fwReasonsList] = useState(["SOP Guidance", "Process education", "System Navigation"]);
            const [fwRequestTypesList] = useState(["Membership", "Billing", "Account Access", "Technical Support", "Order Support"]);

            const fetchTasks = async () => {
                setConnectionStatus('connecting');
                const { data, error } = await supabase.from('tasks').select('*').order('date', { ascending: false });
                if (!error) { setTasks(data || []); setConnectionStatus('online'); }
                else { setConnectionStatus('offline'); }
            };

            useEffect(() => {
                fetchTasks();
                const channel = supabase.channel('tasks-channel').on('postgres_changes', { event: '*', schema: 'public', table: 'tasks' }, fetchTasks).subscribe();
                return () => supabase.removeChannel(channel);
            }, []);

            const handleAddTask = async (e) => {
                e.preventDefault();
                let status = formData.status || 'Pending';
                
                if (!editingTaskId) {
                    if (newTaskType === 'disputes' && (formData.resolution === 'Won' || formData.resolution === 'Lost')) status = 'Resolved';
                    else if (newTaskType === 'pending_subs' && (formData.resolution === 'Activated' || formData.resolution === 'Cancelled')) status = 'Resolved';
                    else if (['weekly_quiz', 'hip_request', 'duplicate_iap'].includes(newTaskType)) status = 'Resolved';
                }

                const details = { ...formData };
                if (!editingTaskId) {
                    if (newTaskType === 'surprise_delight') details.submitterName = currentUser;
                    if (newTaskType === 'floorwalker') details.mentorName = currentUser;
                }

                // Construction without 'priority' field to avoid Supabase schema errors
                const taskData = {
                    type: newTaskType,
                    title: `${categories[newTaskType].label} Log`,
                    agent: currentUser,
                    status,
                    date: editingTaskId ? undefined : new Date().toISOString(),
                    details
                };

                const { error } = editingTaskId 
                    ? await supabase.from('tasks').update(taskData).eq('id', editingTaskId)
                    : await supabase.from('tasks').insert([taskData]);

                if (error) alert("Error: " + error.message);
                else { setIsFormOpen(false); setFormData({}); setEditingTaskId(null); }
            };

            const handleEditTask = (task) => {
                setNewTaskType(task.type);
                setFormData(task.details || {});
                setEditingTaskId(task.id);
                setIsFormOpen(true);
            };

            const handleInputChange = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));

            const handleQuizScore = (moduleId, score) => {
                const scores = { ...(formData.quizScores || {}), [moduleId]: parseInt(score) };
                const values = Object.values(scores);
                const avg = values.length ? (values.reduce((a, b) => a + b, 0) / values.length).toFixed(1) : '0.0';
                setFormData(prev => ({ ...prev, quizScores: scores, overallScore: avg }));
            };

            const handleGenerateReport = () => {
                let filtered = tasks;
                if (reportFilters.category !== 'all') filtered = filtered.filter(t => t.type === reportFilters.category);
                if (reportFilters.agent !== 'all') filtered = filtered.filter(t => t.agent === reportFilters.agent);
                if (reportFilters.startDate) filtered = filtered.filter(t => new Date(t.date) >= new Date(reportFilters.startDate));
                if (reportFilters.endDate) {
                    const end = new Date(reportFilters.endDate); end.setHours(23,59,59);
                    filtered = filtered.filter(t => new Date(t.date) <= end);
                }
                setGeneratedReport(filtered);
            };

            const downloadCSV = () => {
                if (!generatedReport) return;
                const headers = ['ID', 'Type', 'Owner', 'Status', 'Date', 'Details'];
                const csv = [headers.join(','), ...generatedReport.map(t => [t.id, t.type, t.agent, t.status, new Date(t.date).toLocaleDateString(), JSON.stringify(t.details).replace(/,/g, ';')].join(','))].join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = 'mentor_ops_report.csv'; a.click();
            };

            const stats = useMemo(() => ({
                total: tasks.length,
                pending: tasks.filter(t => t.status === 'Pending').length,
                resolved: tasks.filter(t => ['Resolved', 'Activated', 'Won'].includes(t.status)).length,
                byType: Object.keys(categories).reduce((acc, key) => { acc[key] = tasks.filter(t => t.type === key).length; return acc; }, {})
            }), [tasks]);

            const filteredLogs = tasks.filter(t => 
                (categories[t.type]?.label || '').toLowerCase().includes(searchTerm.toLowerCase()) || 
                (t.agent || '').toLowerCase().includes(searchTerm.toLowerCase())
            );
            const paginatedLogs = filteredLogs.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

            if (!currentUser) {
                return (
                    <div className="fixed inset-0 bg-slate-900 z-50 flex items-center justify-center p-4">
                        <Card className="p-8 max-w-md w-full text-center">
                            <div className="h-16 w-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                <User className="h-8 w-8" />
                            </div>
                            <h2 className="text-2xl font-bold mb-2">MentorOps Center</h2>
                            <p className="text-slate-500 mb-8">Select your identity to continue</p>
                            <select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" onChange={(e) => setCurrentUser(e.target.value)} defaultValue="">
                                <option value="" disabled>Select Mentor...</option>
                                {mentorList.map(name => <option key={name} value={name}>{name}</option>)}
                            </select>
                        </Card>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-20">
                        <div className="max-w-7xl mx-auto px-6 flex justify-between items-center h-16">
                            <div className="flex items-center gap-3">
                                <h1 className="text-xl font-bold tracking-[0.2em] text-slate-900">TEMPO</h1>
                                <span className="h-6 w-px bg-slate-200" />
                                <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">Mentor Ops</span>
                            </div>
                            <nav className="flex gap-1">
                                {['dashboard', 'logs', 'reports'].map(tab => (
                                    <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${activeTab === tab ? 'bg-slate-100 text-slate-900' : 'text-slate-500 hover:bg-slate-50'}`}>
                                        {tab.toUpperCase()}
                                    </button>
                                ))}
                            </nav>
                            <div className="flex items-center gap-4">
                                <div className={`h-2 w-2 rounded-full ${connectionStatus === 'online' ? 'bg-emerald-500' : 'bg-rose-500 animate-pulse'}`} />
                                <div className="text-right hidden md:block">
                                    <p className="text-[10px] font-bold text-slate-400 uppercase">Logged In</p>
                                    <p className="text-sm font-bold leading-none">{currentUser}</p>
                                </div>
                                <button onClick={() => setCurrentUser(null)} className="p-2 text-slate-400 hover:text-rose-500"><LogOut className="h-4 w-4" /></button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-6 py-8">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-8 animate-fade-in">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <Card className="p-6 bg-slate-900 text-white border-none shadow-xl">
                                        <p className="text-slate-400 text-xs font-bold uppercase mb-1">Total Records</p>
                                        <h3 className="text-4xl font-bold">{stats.total}</h3>
                                    </Card>
                                    <Card className="p-6 border-l-4 border-l-rose-500">
                                        <p className="text-slate-400 text-xs font-bold uppercase mb-1">Follow-ups Req.</p>
                                        <h3 className="text-4xl font-bold text-rose-600">{stats.pending}</h3>
                                    </Card>
                                    <Card className="p-6 border-l-4 border-l-emerald-500">
                                        <p className="text-slate-400 text-xs font-bold uppercase mb-1">Resolved</p>
                                        <h3 className="text-4xl font-bold text-emerald-600">{stats.resolved}</h3>
                                    </Card>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
                                    {Object.entries(categories).map(([key, cfg]) => (
                                        <button key={key} onClick={() => { setNewTaskType(key); setEditingTaskId(null); setFormData({}); setIsFormOpen(true); }} className="p-4 bg-white border border-slate-200 rounded-xl text-center hover:shadow-md transition-all group">
                                            <div className={`h-10 w-10 mx-auto rounded-lg flex items-center justify-center mb-2 bg-${cfg.color}-100`}>
                                                {React.createElement(cfg.icon, { className: `h-5 w-5 text-${cfg.color}-600` })}
                                            </div>
                                            <p className="text-[10px] font-bold text-slate-500 uppercase">{cfg.label}</p>
                                            <p className="text-xl font-bold">{stats.byType[key]}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'logs' && (
                            <div className="space-y-4 animate-fade-in">
                                <div className="flex flex-col md:flex-row gap-4 justify-between bg-white p-4 rounded-xl border border-slate-200">
                                    <div className="relative flex-1 max-w-md">
                                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" />
                                        <input type="text" placeholder="Search logs..." className="w-full pl-10 pr-4 py-2 text-sm bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                    </div>
                                    <button onClick={() => { setEditingTaskId(null); setFormData({}); setIsFormOpen(true); }} className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold shadow-lg shadow-blue-100 hover:bg-blue-700">
                                        <Plus className="h-4 w-4" /> New Entry
                                    </button>
                                </div>
                                <Card className="overflow-hidden">
                                    <table className="w-full text-left text-sm">
                                        <thead className="bg-slate-50 border-b border-slate-200">
                                            <tr>
                                                <th className="px-6 py-4">Category</th>
                                                <th className="px-6 py-4">Agent</th>
                                                <th className="px-6 py-4">Status</th>
                                                <th className="px-6 py-4">Date</th>
                                                <th className="px-6 py-4 text-right">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {paginatedLogs.map(task => (
                                                <tr key={task.id} className="hover:bg-slate-50 transition-colors">
                                                    <td className="px-6 py-4">
                                                        <div className="flex items-center gap-3">
                                                            <div className={`h-8 w-8 rounded-lg flex items-center justify-center bg-${categories[task.type]?.color}-100`}>
                                                                {React.createElement(categories[task.type]?.icon || AlertCircle, { className: `h-4 w-4 text-${categories[task.type]?.color}-600` })}
                                                            </div>
                                                            <span className="font-medium text-slate-700">{categories[task.type]?.label}</span>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4 text-slate-600">{task.agent}</td>
                                                    <td className="px-6 py-4">
                                                        <Badge color={task.status === 'Pending' ? 'amber' : (['Resolved', 'Won', 'Activated'].includes(task.status) ? 'green' : 'slate')}>
                                                            {task.status}
                                                        </Badge>
                                                    </td>
                                                    <td className="px-6 py-4 text-slate-400">{new Date(task.date).toLocaleDateString()}</td>
                                                    <td className="px-6 py-4 text-right">
                                                        <button onClick={() => handleEditTask(task)} className="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"><Edit className="h-4 w-4" /></button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    <div className="p-4 bg-slate-50 flex justify-between items-center text-xs font-bold text-slate-500">
                                        <span>Showing {(currentPage-1)*itemsPerPage+1} to {Math.min(currentPage*itemsPerPage, filteredLogs.length)} of {filteredLogs.length}</span>
                                        <div className="flex gap-2">
                                            <button disabled={currentPage === 1} onClick={() => setCurrentPage(p => p - 1)} className="px-3 py-1 bg-white border rounded hover:bg-slate-100 disabled:opacity-50">Prev</button>
                                            <button disabled={currentPage * itemsPerPage >= filteredLogs.length} onClick={() => setCurrentPage(p => p + 1)} className="px-3 py-1 bg-white border rounded hover:bg-slate-100 disabled:opacity-50">Next</button>
                                        </div>
                                    </div>
                                </Card>
                            </div>
                        )}

                        {activeTab === 'reports' && (
                            <div className="space-y-6 animate-fade-in">
                                <Card className="p-6 space-y-4">
                                    <div className="flex items-center gap-3 mb-2">
                                        <div className="h-8 w-8 bg-blue-100 rounded-lg flex items-center justify-center"><Filter className="h-5 w-5 text-blue-600" /></div>
                                        <h2 className="text-lg font-bold">Report Generator</h2>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div><label className="text-[10px] font-bold text-slate-400 uppercase">Category</label>
                                            <select className="w-full p-2.5 bg-slate-50 border rounded-lg text-sm outline-none" value={reportFilters.category} onChange={e => setReportFilters(f => ({ ...f, category: e.target.value }))}>
                                                <option value="all">All Types</option>
                                                {Object.entries(categories).map(([k, c]) => <option key={k} value={k}>{c.label}</option>)}
                                            </select>
                                        </div>
                                        <div><label className="text-[10px] font-bold text-slate-400 uppercase">Mentor</label>
                                            <select className="w-full p-2.5 bg-slate-50 border rounded-lg text-sm outline-none" value={reportFilters.agent} onChange={e => setReportFilters(f => ({ ...f, agent: e.target.value }))}>
                                                <option value="all">All Mentors</option>
                                                {mentorList.map(m => <option key={m} value={m}>{m}</option>)}
                                            </select>
                                        </div>
                                        <div><label className="text-[10px] font-bold text-slate-400 uppercase">Start Date</label>
                                            <input type="date" className="w-full p-2.5 bg-slate-50 border rounded-lg text-sm outline-none" value={reportFilters.startDate} onChange={e => setReportFilters(f => ({ ...f, startDate: e.target.value }))} />
                                        </div>
                                        <div><label className="text-[10px] font-bold text-slate-400 uppercase">End Date</label>
                                            <input type="date" className="w-full p-2.5 bg-slate-50 border rounded-lg text-sm outline-none" value={reportFilters.endDate} onChange={e => setReportFilters(f => ({ ...f, endDate: e.target.value }))} />
                                        </div>
                                    </div>
                                    <div className="flex justify-end pt-2">
                                        <button onClick={handleGenerateReport} className="px-6 py-2.5 bg-slate-900 text-white font-bold rounded-lg hover:bg-slate-800 shadow-lg">GENERATE REPORT</button>
                                    </div>
                                </Card>
                                {generatedReport && (
                                    <div className="space-y-4 animate-fade-in">
                                        <div className="flex justify-between items-center">
                                            <h3 className="font-bold text-lg">Results ({generatedReport.length})</h3>
                                            <button onClick={downloadCSV} className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 text-slate-700 font-bold rounded-lg text-sm hover:bg-slate-50">
                                                <Download className="h-4 w-4" /> Export CSV
                                            </button>
                                        </div>
                                        <Card className="overflow-x-auto"><table className="w-full text-left text-sm"><thead className="bg-slate-50 border-b"><tr><th className="px-6 py-3">Type</th><th className="px-6 py-3">Agent</th><th className="px-6 py-3">Date</th><th className="px-6 py-3 text-right">Status</th></tr></thead><tbody className="divide-y">{generatedReport.map(r => (<tr key={r.id} className="hover:bg-slate-50"><td className="px-6 py-4 font-medium">{categories[r.type]?.label}</td><td className="px-6 py-4">{r.agent}</td><td className="px-6 py-4 text-slate-400">{new Date(r.date).toLocaleDateString()}</td><td className="px-6 py-4 text-right"><Badge color={r.status === 'Pending' ? 'amber' : 'green'}>{r.status}</Badge></td></tr>))}</tbody></table></Card>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {isFormOpen && (
                        <div className="fixed inset-0 z-50 flex justify-end">
                            <div className="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onClick={() => setIsFormOpen(false)} />
                            <div className="relative w-full max-w-md bg-white h-full shadow-2xl p-8 overflow-y-auto animate-slide-in-right">
                                <div className="flex justify-between items-center mb-8">
                                    <div className="flex items-center gap-3">
                                        <div className={`p-2 rounded-lg bg-${categories[newTaskType].color}-100`}>
                                            {React.createElement(categories[newTaskType].icon, { className: `h-6 w-6 text-${categories[newTaskType].color}-600` })}
                                        </div>
                                        <h2 className="text-2xl font-black italic">{editingTaskId ? 'EDIT' : 'NEW'} {categories[newTaskType].label.toUpperCase()}</h2>
                                    </div>
                                    <button onClick={() => setIsFormOpen(false)} className="text-slate-400 hover:text-slate-600 uppercase text-[10px] font-black">Close</button>
                                </div>
                                <form onSubmit={handleAddTask} className="space-y-6">
                                    {!editingTaskId && (
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block">Change Category</label>
                                            <select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm font-bold" value={newTaskType} onChange={e => setNewTaskType(e.target.value)}>
                                                {Object.entries(categories).map(([k, c]) => <option key={k} value={k}>{c.label}</option>)}
                                            </select>
                                        </div>
                                    )}

                                    <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100 space-y-4">
                                        {categories[newTaskType].fields.map(field => {
                                            if (field === 'correctionModule') return (
                                                <div key={field} className="space-y-6 pt-2">
                                                    <div className="flex justify-between items-center"><h3 className="text-[10px] font-black text-slate-400 uppercase">Correction Module</h3><Badge color="cyan">AVG: {formData.overallScore || '0.0'}</Badge></div>
                                                    {quizModules.map(m => (
                                                        <div key={m.id} className="bg-white p-4 rounded-xl border border-slate-200">
                                                            <p className="font-bold text-sm mb-1">{m.title}</p>
                                                            <p className="text-[10px] text-slate-400 mb-4">{m.desc}</p>
                                                            <div className="flex justify-between items-center mb-4">
                                                                <span className="text-[10px] font-bold text-slate-300">1</span>
                                                                <div className="flex gap-2">
                                                                    {[1, 2, 3, 4, 5].map(s => (
                                                                        <button key={s} type="button" onClick={() => handleQuizScore(m.id, s)} className={`w-8 h-8 rounded-full border-2 text-xs font-bold transition-all ${formData.quizScores?.[m.id] === s ? 'bg-cyan-500 border-cyan-500 text-white shadow-lg shadow-cyan-100' : 'bg-white border-slate-200 text-slate-400'}`}>{s}</button>
                                                                    ))}
                                                                </div>
                                                                <span className="text-[10px] font-bold text-slate-300">5</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            );

                                            const isDropdown = ['associateName', 'agent', 'team', 'productType', 'surpriseAndDelightType', 'resolution', 'pendingReason', 'disputeReason', 'reasonForSupport', 'requestType', 'validHip', 'validRequest', 'subscriptionStatus', 'emailSent'].includes(field);
                                            
                                            return (
                                                <div key={field}>
                                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 block">{field.replace(/([A-Z])/g, ' $1')}</label>
                                                    {isDropdown ? (
                                                        <select className="w-full p-3 bg-white border border-slate-200 rounded-xl outline-none text-sm font-medium focus:ring-2 focus:ring-blue-500" value={formData[field] || ''} onChange={e => handleInputChange(field, e.target.value)}>
                                                            <option value="">Select...</option>
                                                            {field === 'associateName' && associateList.map(a => <option key={a} value={a}>{a}</option>)}
                                                            {field === 'team' && ['Mentor', 'Social Media', 'T1', 'Order Support', 'Product Support'].map(t => <option key={t} value={t}>{t}</option>)}
                                                            {field === 'productType' && ['Accessories', 'Membership', 'Tempo Move', 'Tempo Core', 'Tempo Studio'].map(p => <option key={p} value={p}>{p}</option>)}
                                                            {field === 'pendingReason' && pendingReasonsList.map(r => <option key={r} value={r}>{r}</option>)}
                                                            {field === 'disputeReason' && disputeReasonsList.map(r => <option key={r} value={r}>{r}</option>)}
                                                            {field === 'reasonForSupport' && fwReasonsList.map(r => <option key={r} value={r}>{r}</option>)}
                                                            {field === 'requestType' && fwRequestTypesList.map(r => <option key={r} value={r}>{r}</option>)}
                                                            {field === 'resolution' && (newTaskType === 'disputes' ? ['Pending', 'Won', 'Lost'] : (newTaskType === 'pending_subs' ? ['Pending', 'Activated', 'Cancelled'] : ['Pending', 'Resolved'])).map(r => <option key={r} value={r}>{r}</option>)}
                                                            {['validHip', 'validRequest', 'emailSent'].includes(field) && ['Yes', 'No'].map(v => <option key={v} value={v}>{v}</option>)}
                                                            {field === 'subscriptionStatus' && ['Active', 'Cancelled'].map(v => <option key={v} value={v}>{v}</option>)}
                                                        </select>
                                                    ) : (
                                                        <input type={field.toLowerCase().includes('date') ? 'date' : 'text'} className="w-full p-3 bg-white border border-slate-200 rounded-xl outline-none text-sm font-medium focus:ring-2 focus:ring-blue-500" value={formData[field] || ''} onChange={e => handleInputChange(field, e.target.value)} />
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>

                                    {!['weekly_quiz', 'hip_request', 'duplicate_iap'].includes(newTaskType) && (
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 block">Record Status</label>
                                            <select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none text-sm font-bold" value={formData.status || 'Pending'} onChange={e => handleInputChange('status', e.target.value)}>
                                                <option value="Pending">Pending</option>
                                                <option value="Resolved">Resolved</option>
                                                <option value="In Progress">In Progress</option>
                                            </select>
                                        </div>
                                    )}

                                    <button type="submit" className="w-full py-4 bg-blue-600 text-white font-black rounded-2xl shadow-xl shadow-blue-100 hover:bg-blue-700 transition-all uppercase tracking-widest">
                                        {editingTaskId ? 'Update Log' : 'Save Record'}
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MentorOpsCenter />);
    </script>
</body>
</html>
